(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{1419:function(e,t,n){"use strict";n.d(t,"a",function(){return V});var r=n(1),a=n(109),o=(n(1422),n(146)),i=n.n(o),c=(n(167),n(353)),s=n.n(c),l=(n(578),n(352)),u=n.n(l),p=(n(248),n(1377)),m=n.n(p),d=(n(1376),n(1371)),f=n.n(d),h=(n(1370),n(168)),g=n.n(h),y=(n(354),n(23)),v=n.n(y),b=(n(351),n(582)),w=n.n(b),C=(n(581),n(584)),E=n.n(C),S=(n(583),n(580)),T=n.n(S),k=(n(579),n(11)),N=n(16),O=n.n(N);function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function j(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var $=s.a.Option,M=u.a.Group,D=f.a.RangePicker,L=T.a.CheckableTag,_={SelectInput:function(e){var t=e.selectValue,n=e.inputValue,a=e.placeholder,o=e.options,i=e.onSelectChange,c=e.onInputChange,l=e.onPressEnter,p=e.selectStyle;return r.createElement(M,{compact:!0},r.createElement(s.a,{style:p?Object.assign({width:110},p):{width:110},value:t,onChange:i},o&&o.map(function(e,t){return r.createElement($,{key:t,value:e.value},e.title)})),r.createElement(u.a,{style:{width:238},value:n,onChange:c,placeholder:a,onPressEnter:l}))},Select:function(e){var t=e.option,n=e.label,a=e.mode,o=e.onSearch,i=e.onSelect,c=e.onBlur,l=e.onFocus,u=e.value,p=e.placeholder,m=e.showSearch,d=e.width,f=e.filterOption,h=e.onChange,g=e.allowClear,y=e.onPopupScroll;return r.createElement(r.Fragment,null,n&&r.createElement("span",{className:"common-list-label"},"".concat(n,"：")),r.createElement("span",{className:"common-list-control"},r.createElement(s.a,{allowClear:g,value:u,mode:a||!1,style:{minWidth:d||258,width:d},showSearch:m,placeholder:p,filterOption:f,onSearch:o,onSelect:i,onChange:h,onBlur:c,onPopupScroll:y,onFocus:l},t.data.map(function(e){return r.createElement($,{key:e[t.key]||e.id,value:e[t.value]||e.id,$data:e},e[t.title])}))))},DatePicker:function(e){var t=e.label,n=e.placeholder,a=e.onChange,o=e.value,i=e.style,c=e.format,s=e.showTime;return r.createElement(r.Fragment,null,t&&r.createElement("span",{className:"common-list-label"},"".concat(t,"：")),r.createElement("span",{className:"common-list-control"},r.createElement(f.a,{format:c||!1,style:i,showTime:s,placeholder:n,value:o,onChange:a})))},RangePicker:function(e){var t=e.label,n=e.alias,a=e.placeholder,o=e.onChange,c=e.value,s=e.showTime,l=e.format;return r.createElement(r.Fragment,null,t&&r.createElement("span",{className:"common-list-label"},"".concat(t,"：")),r.createElement("span",{className:"common-list-control"},r.createElement(D,{style:{width:400},showTime:s,format:l,placeholder:a,value:c,onChange:o}),r.createElement("span",{className:"common-list-control-date-alias"},!k.a.isEmpty(n)&&n.map(function(e,t){return r.createElement(i.a,{key:t,onClick:function(){return o([O()(Date.now()-864e5*e).startOf("day"),O()()])}},e," 天内")}))))},Input:function(e){var t=e.label,n=e.value,a=e.placeholder,o=e.onChange,i=e.width,c=e.onPressEnter;return r.createElement(r.Fragment,null,t&&r.createElement("span",{className:"common-list-label"},"".concat(t,"：")),r.createElement("span",{className:"common-list-control"},r.createElement(u.a,{style:{minWidth:i||258},value:n,onChange:o,placeholder:a,onPressEnter:c})))},Checkbox:function(e){var t=e.label,n=e.value,a=e.onChange;return r.createElement(g.a,{checked:n,onChange:a},t)},CheckableTag:function(e){var t=e.label,n=e.option,a=e.value,o=e.onChange;return r.createElement(r.Fragment,null,t&&r.createElement("span",{className:"common-list-label"},"".concat(t,"：")),r.createElement("span",{className:"common-list-control"},!k.a.isEmpty(n)&&n.map(function(e){return r.createElement(L,{key:e.value,checked:e.value===a,onChange:function(){o(e)}},e.title)})))},Label:function(e,t){var n=e.label;return r.createElement(r.Fragment,null,n&&r.createElement("span",{className:"common-list-label"},"".concat(n,"：")),r.createElement("span",{className:"common-list-control"},t))},Custom:function(e){return r.createElement("div",null,(void 0).props.children)}},V=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=j(this,R(t).apply(this,arguments))).state={collapse:!0},e.toggleCollapse=function(t){e.setState({collapse:!e.state.collapse})},e.renderSearcher=function(){var t=e.props.config,n=t.searcher,a=t.table,o=e.state.collapse;return n&&r.createElement("section",{className:"common-list-search"},e.renderWidgets(n.widgets),a&&a.tableHeader&&a.tableHeader(),r.createElement("div",{className:"common-list-search-right"},!n.hideSearcher&&r.createElement(r.Fragment,null,r.createElement(i.a,{type:"primary",onClick:n.onSearch},"查询"),r.createElement(i.a,{onClick:n.onReset},"重置")),n.collapseControl&&n.collapseControl.showMoreBtn&&r.createElement("span",{className:"common-list-serach-more"},r.createElement("a",{onClick:e.toggleCollapse},o?"更多":"收起"," ",r.createElement(v.a,{type:o?"down":"up"})))))},e.renderWidgets=function(t){var n=e.state.collapse,a=e.props.config.searcher;return t&&r.createElement("div",{className:"common-list-search-left"},t.map(function(t,o){return Array.isArray(t)?r.createElement("div",{key:o,className:"common-list-search-row",style:{display:a.collapseControl&&a.collapseControl.showMoreBtn&&n&&o>0?"none":"flex"}},t.map(function(t){return r.createElement("div",{key:t.label,className:"common-list-search-col",style:Object.assign({},t.style)},_[t.type]&&_[t.type](t,t.children?e.renderWidgets(t.children):null))})):r.createElement("div",{key:t.label,className:"common-list-search-row ".concat(t.className)},_[t.type]&&_[t.type](t,t.children?e.renderWidgets(t.children):null))}))},e.renderAddBtn=function(){var t=e.props.config,n=t.addBtn,a=t.searcher;return n&&r.createElement("section",{className:"common-list-addbtn",style:n.style},"function"==typeof n.title?r.createElement(n.title,null):n.title,r.createElement("div",{className:"common-list-search-batch"},a.batchControl.showBatchControl&&r.createElement(s.a,{placeholder:a.batchControl.placeholder,style:{minWidth:120},defaultValue:void 0,onChange:a.batchControl.onBatch},a.batchControl.options.map(function(e){return r.createElement($,{key:e.value,value:e.value},e.title)}))))},e.renderTableHeader=function(){var t=e.props.config.tableHeader;return r.createElement("section",{className:"common-list-table-header"},t&&t())},e.renderTable=function(){var t=e.props.config.table,n=t.rowKey,a=t.rowSelection,o=t.columns,i=t.dataSource,c=t.pagination,s=t.onChange,l=t.loading,u=t.locale;return r.createElement("section",{className:"common-list-table"},r.createElement(m.a,{locale:u,rowKey:n||"id",rowSelection:a,columns:o,dataSource:i,loading:l,pagination:c,onChange:s}))},e.renderCards=function(){var t=e.props.config.cards,n=t.dataSource,a=t.loading,o=t.pagination,i=t.renderCard,c=t.addBtn;return r.createElement("div",{className:"common-list-cards-wrapper"},r.createElement("ul",{className:"common-list-cards"},a?r.createElement("div",{className:"common-list-cards-loading"},r.createElement(E.a,null)):r.createElement(r.Fragment,null,r.createElement("li",{className:"common-list-card add-btn"},r.createElement("div",{className:"common-list-card-item",onClick:c.onAddBtnClick},c.icon?r.createElement("img",{src:c.icon,alt:""}):r.createElement(v.a,{type:"plus-circle"}),r.createElement("p",null,c.title))),n.map(function(e){return r.createElement("li",{className:"common-list-card"},r.createElement("div",{className:"common-list-card-item"},i(e)))}))),r.createElement("section",{className:"common-list-cards-pagination"},r.createElement(w.a,Object.assign({},o))))},e}var n,o,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,a["a"]),n=t,(o=[{key:"render",value:function(){var e=this.props.config;return r.createElement("div",{className:"common-list"},this.renderSearcher(),this.renderAddBtn(),this.renderTableHeader(),e.table&&this.renderTable(),e.cards&&this.renderCards())}}])&&x(n.prototype,o),c&&x(n,c),t}()},1420:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(1),a=n(1375),o=n.n(a),i=(n(1374),n(11));n(1421);function c(e){var t=i.a.getPageBreadcrumb(e.location.pathname),n=e.title,a=e.links,c=e.tabs,s=e.currentTab;return r.createElement("div",{className:"common-header"},r.createElement("section",{className:"common-header-breadcrumb"},t&&r.createElement(o.a,null,t.map(function(e,t){return r.createElement(o.a.Item,{key:t},e.title)}))),r.createElement("section",{className:"common-header-title"},r.createElement("h2",null,n),r.createElement("div",{className:"common-header-links"},a&&a.map(function(t,n){return r.createElement("a",{key:n,onClick:function(){e.history.push(t.path)}},t.title)}))),r.createElement("section",{className:"common-header-tabs"},c&&c.map(function(t,n){return r.createElement("a",{onClick:function(){e.onTabClick(t.id)},className:"".concat(s===t.id?"tab-active":""," ")},r.createElement("span",null,t.title),t.tipComponent&&t.tipComponent())})))}},1421:function(e,t,n){},1422:function(e,t,n){},1440:function(e,t,n){},1495:function(e,t,n){},1496:function(e,t,n){},1510:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(1),o=n(109),i=n(1369),c=n.n(i),s=(n(1368),n(1378),n(351),n(586),n(120)),l=n(110),u=n(1420),p=n(200),m=n(11),d=(n(1495),n(1372),n(352)),f=n.n(d),h=(n(248),n(1379)),g=n.n(h),y=n(1395),v=n.n(y),b=(n(1394),n(1392)),w=n.n(b),C=(n(1391),n(146)),E=n.n(C),S=(n(167),n(23)),T=n.n(S),k=n(1385),N=n.n(k),O=(n(1384),n(16)),I=n.n(O);function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var j=function(e){var t=e.state.showPopconfirmId,n=[{title:"分类名称",width:140,dataIndex:"topicTypeName"},{title:"创建时间",width:300,render:function(e,t){return I()(t.createTime).format("YYYY.MM.DD HH:mm")}},{title:"话题数",width:140,dataIndex:"topicNum"},{title:"排序",width:200,render:function(n,r){return a.createElement("div",{className:"category-order-".concat(r.topicTypeId)},a.createElement("p",null,r.topicSort," ",a.createElement(N.a,{visible:r.topicTypeId===t,icon:null,title:e.renderOrderElem(r),getPopupContainer:function(){return document.getElementsByClassName("category-order-".concat(r.topicTypeId))[0]},onConfirm:e.confirmOrder.bind(void 0,r),onCancel:e.cancelOrder,okText:"确定",cancelText:"取消"},a.createElement(T.a,{type:"edit",onClick:function(){return e.setState({showPopconfirmId:r.topicTypeId,order:{key:r.topicTypeId,value:r.topicSort}})}}))," "))}},{title:"操作",render:function(t,n){return a.createElement("div",{className:"common-list-table-operation"},a.createElement("span",{onClick:function(){e.setState({currentCategory:n},function(){e.toggleCategoryModal()})}},"编辑"),"    ",a.createElement("span",{onClick:function(){e.props.toggleTab("topic-list"),e.props.history.push("/admin/community/topic/category/topic-list?categoryId=".concat(n.topicTypeId))}},"查看话题"),"    ",a.createElement("span",{style:{color:"#CCC"},onClick:function(){return e.delOperation(n)}},"删除分类"))}}],r=Object.assign({},e.props.common.paginationConfig,{current:e.state.currentPage,total:e.props.community.categoryListMeta.total,showTotal:!1,onShowSizeChange:function(t,n){e.resetPagination(n,t)}});return{addBtn:{title:function(){return a.createElement(E.a,{type:"primary",onClick:function(){return e.toggleCategoryModal()}},a.createElement(T.a,{type:"plus"}),"创建分类")}},searcher:{batchControl:{showBatchControl:!1},hideSearcher:!0},table:{rowKey:"topicTypeId",columns:n,dataSource:e.props.community.categoryList,loading:e.state.tableLoading,pagination:r,onChange:function(t,n,r){var a={pageNum:t.current,limit:t.pageSize};if(!m.a.isEmpty(n))for(var o=0,i=Object.entries(n);o<i.length;o++){var c=x(i[o],2),s=c[0],l=c[1];a[s]=l?l[0]:void 0}m.a.isEmpty(r)||(a.orderBy="".concat(r.field),a.sort="".concat("descend"===r.order?"desc":"asc")),e.setState({filter:Object.assign({},e.state.filter,a),currentPage:t.current},function(){e.getDataList(e.state.filter)})}}}},R=n(1419),P=n(147),$=n.n(P);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var F=c.a.confirm,B=function(e){function t(e){var n,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=L(t).call(this,e),(n=!i||"object"!==M(i)&&"function"!=typeof i?_(o):i).state={tableLoading:!1,categoryModalVisible:!1,currentPage:1,showPopconfirmId:0,filter:{},order:{key:void 0,value:void 0},currentCategory:{},isSameCategoryName:!1},n.resetPagination=function(e,t){return r.a(_(n),void 0,void 0,regeneratorRuntime.mark(function n(){var a=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:this.setState({filter:Object.assign({},this.state.filter,{limit:e,pageNum:t})},function(){return r.a(a,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.filter,this.getDataList(t);case 2:case"end":return e.stop()}},e,this)}))});case 1:case"end":return n.stop()}},n,this)}))},n.toggleCategoryModal=function(){n.setState({categoryModalVisible:!n.state.categoryModalVisible})},n.getDataList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},n.state.filter,e);n.setState({filter:t,tableLoading:!0},function(){return r.a(_(n),void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.community.getCategoryList({params:t});case 2:this.setState({tableLoading:!1});case 3:case"end":return e.stop()}},e,this)}))})},n.renderOrderElem=function(e){var t=n.state.order;return a.createElement("div",{key:e.topicTypeId},a.createElement("span",null,"排序  "),a.createElement(g.a,{min:0,onChange:n.changeOrder.bind(_(n),e.topicTypeId),value:t.value}))},n.changeOrder=function(e,t){return t&&Number.isNaN(Number(t))?n.$msg.error("请输入正确排序值"):t&&t.toString().length>3?n.$msg.error("排序值不得超过 3 位"):void n.setState({order:{key:e,value:t}})},n.confirmOrder=function(e){return r.a(_(n),void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.order,n=this.props.common.userInfo,e.next=4,this.$api.community.updateOrder({params:{topicTypeId:t.key,topicSort:t.value,updateUser:n.empName}});case 4:0==(r=e.sent).data.ret?(this.$msg.success("修改排序成功"),this.getDataList(this.state.filter),this.cancelOrder()):this.$msg.error(r.data.msg);case 6:case"end":return e.stop()}},e,this)}))},n.cancelOrder=function(){n.setState({showPopconfirmId:0,order:{key:void 0,value:void 0}})},n.checkCategoryName=function(e){return r.a(_(n),void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={typeName:e},t.next=3,this.$api.community.checkCategoryName({params:n});case 3:r=t.sent,a=!m.a.isEmpty(r.data.data),this.setState({isSameCategoryName:a}),a&&e&&this.$msg.warn("".concat(e,"分类名称已存在"));case 7:case"end":return t.stop()}},t,this)}))},n.setCategoryName=function(e){return r.a(_(n),void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.target.value,this.checkCategoryName(n),this.setState({currentCategory:Object.assign({},this.state.currentCategory,{topicTypeName:n?n.trim():void 0})});case 3:case"end":return t.stop()}},t,this)}))},n.delOperation=function(e){return r.a(_(n),void 0,void 0,regeneratorRuntime.mark(function t(){var n,a=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.setState({showPopconfirmId:0}),n=this.props.common.userInfo,F({title:"分类删除操作",content:"请问是否删除当前选中的分类",onOk:function(){return r.a(a,void 0,void 0,regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.$api.community.deleteCategory({params:{topicTypeId:e.topicTypeId,updateUser:n.empName}});case 2:0==(r=t.sent).data.ret?(this.$msg.success("删除话题分类成功"),this.getDataList(this.state.filter)):this.$msg.error(r.data.msg);case 4:case"end":return t.stop()}},t,this)}))},onCancel:function(){}});case 3:case"end":return t.stop()}},t,this)}))},n.onCategoryModalConfirm=function(){return r.a(_(n),void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.currentCategory,r=t.isSameCategoryName,a=this.props.common.userInfo,n.topicTypeName){e.next=4;break}return e.abrupt("return",this.$msg.warn("分类名称不能为空"));case 4:if(!(n.topicTypeName&&n.topicTypeName.length>6)){e.next=6;break}return e.abrupt("return",this.$msg.warn("分类名称不得超过 6 个字"));case 6:if(!r){e.next=8;break}return e.abrupt("return",this.$msg.warn("".concat(n.topicTypeName,"分类名称已存在")));case 8:if(!n.topicTypeId){e.next=14;break}return e.next=11,this.$api.community.updateCategory({params:{topicTypeId:n.topicTypeId,topicTypeName:n.topicTypeName,updateUser:a.empName}});case 11:o=e.sent,e.next=17;break;case 14:return e.next=16,this.$api.community.createCategory({params:{topicTypeName:n.topicTypeName,createUser:a.empName}});case 16:o=e.sent;case 17:0==o.data.ret?(this.$msg.success(n.topicTypeId?"更新分类成功":"创建分类成功"),this.getDataList(this.state.filter),this.toggleCategoryModal(),this.setState({currentCategory:{}})):this.$msg.error(o.data.msg);case 18:case"end":return e.stop()}},e,this)}))},n.onCategoryModalCancel=function(){n.setState({categoryModalVisible:!1,currentCategory:{}})},n.checkCategoryName=$()(n.checkCategoryName,800),n}var n,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(t,o["a"]),n=t,(i=[{key:"componentDidMount",value:function(){return r.a(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props.common.paginationConfig,n=t.defaultPageSize,r=t.defaultCurrent,this.resetPagination(n,r);case 2:case"end":return e.stop()}},e,this)}))}},{key:"render",value:function(){var e=this.state,t=e.currentCategory,n=e.categoryModalVisible;return a.createElement("div",{className:"category-list"},a.createElement(R.a,Object.assign({},this.props,{config:j(this)})),a.createElement(c.a,{visible:n,title:m.a.isEmpty(t.topicTypeId)?"创建分类":"编辑分类",onOk:this.onCategoryModalConfirm,onCancel:this.onCategoryModalCancel},a.createElement(v.a,{type:"flex",align:"middle"},a.createElement(w.a,{offset:2,span:4},"分类名称："),a.createElement(w.a,{span:8},a.createElement(f.a,{placeholder:"请输入分类名称",value:t&&t.topicTypeName,onChange:this.setCategoryName})))))}}])&&D(n.prototype,i),s&&D(n,s),t}(),U=B=r.b([Object(l.b)("common","community"),l.c],B),H=(n(1440),n(1383)),z=n.n(H),A=n(1390),K=n.n(A);n(1389);function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var q=function(e){var t=e.state,n=t.showPopconfirmId,o={selectedRowKeys:t.selectedRowKeys,onChange:function(t,n){e.setState({selectedRowKeys:t})}},i=[{title:"话题 ID",width:100,dataIndex:"topicId"},{title:"话题名称",width:140,dataIndex:"topicName",render:function(e,t){return e}},{title:"话题简介",width:200,dataIndex:"topicDesc",render:function(e,t){return a.createElement(z.a,{content:t.topicDesc},m.a.ellipsis(t.topicDesc||" -- ",20))}},{title:"点击量",width:120,sorter:!0,dataIndex:"clickStatus",render:function(e,t){return t.clicks}},{title:"热度",width:100,sorter:!0,dataIndex:"heatStatus",render:function(e,t){return t.topicHeat}},{title:"动态",sorter:!0,width:100,dataIndex:"feedStatus",render:function(e,t){return t.totalFeed}},{title:"创建时间",width:300,render:function(e,t){return I()(t.createTime).format("YYYY.MM.DD HH:mm")}},{title:"排序",sorter:!0,dataIndex:"sortStatus",width:200,render:function(t,r){return a.createElement("div",{className:"topic-order-".concat(r.topicId)},a.createElement("p",null,r.weight," ",a.createElement(N.a,{visible:r.topicId===n,icon:null,title:e.renderOrderElem(r),getPopupContainer:function(){return document.getElementsByClassName("topic-order-".concat(r.topicId))[0]},onConfirm:e.confirmOrder.bind(void 0,r),onCancel:e.cancelOrder,okText:"确定",cancelText:"取消"},a.createElement(T.a,{type:"edit",onClick:function(){return e.setState({showPopconfirmId:r.topicId,order:{key:r.topicId,value:r.weight}})}}))," "))}},{title:"状态",width:200,dataIndex:"topicStatus",render:function(e,t){var n=1==e?"正常":"屏蔽",r=1==e?"success":"error";return a.createElement(K.a,{status:r,text:n})}},{title:"操作",width:240,render:function(t,n){return a.createElement("div",{className:"common-list-table-operation"},a.createElement("span",{onClick:function(){e.props.community.setCurrentTopic(n),e.toggleTopicModal()}},"编辑"),"    ",a.createElement("span",{onClick:function(){return r.a(void 0,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.blockOperation([n.topicId],1==n.topicStatus?9:1);case 1:case"end":return t.stop()}},t)}))}},1==n.topicStatus?"屏蔽":"取消屏蔽"),"    ",a.createElement("span",{onClick:function(){return e.delOperation([n.topicId])}},"移除"))}}],c={batchControl:{placeholder:"批量操作",showBatchControl:!m.a.isEmpty(e.state.selectedRowKeys),options:[{title:"屏蔽",value:"block"},{title:"取消屏蔽",value:"unblock"},{title:"移除",value:"remove"}],onBatch:function(t,n){e.onBatch(t)}},widgets:[[{type:"Select",label:"所属分类",showSearch:!0,placeholder:"请选择话题分类",value:e.state.categoryValue,option:{key:"topicTypeId",value:"topicTypeId",title:"topicTypeName",data:e.state.categoryOptions||[]},onSearch:function(t){e.onCategorySearch(t)},onChange:function(t,n){e.onCategorySelect(t,n)},onSelect:function(e,t){},onBlur:function(){},onFocus:function(){e.onCategoryFocus()},onPopupScroll:function(t){e.onCategoryPopupScroll(t)}},{type:"SelectInput",label:"话题",placeholder:"请输入话题 ID 或话题名称",options:[{title:"话题 ID",value:"topicId"},{title:"话题名称",value:"topicName"}],inputValue:e.state.topicValue,selectValue:e.state.topicField,onSelectChange:function(t){e.setTopicField(t)},onInputChange:function(t){e.setTopicValue(t.target.value)}}],{type:"Label",label:"其他选项",className:"other-opts",children:[{type:"Label",label:"筛选",className:"other-opts",children:[[{type:"Select",label:"",showSearch:!1,placeholder:"全部状态",value:e.state.topicStatus,option:{key:"id",value:"id",title:"title",data:[{id:void 0,title:"全部"},{id:1,title:"正常"},{id:9,title:"屏蔽"}]},onSelect:function(t,n){e.onFilterSelect("topicStatus",t,n)},onBlur:function(){}}]]}]}],onSearch:function(){e.onSearch()},onReset:function(){e.onReset()}},s=Object.assign({},e.props.common.paginationConfig,{current:e.state.currentPage,total:e.props.community.topicListMeta.total,onShowSizeChange:function(t,n){e.resetPagination(n,t)}});return{addBtn:{title:function(){return a.createElement(E.a,{type:"primary",onClick:function(){e.props.community.setCurrentTopic({}),e.toggleTopicModal()}},a.createElement(T.a,{type:"plus"}),"添加话题")}},searcher:c,table:{rowKey:"topicId",rowSelection:o,columns:i,dataSource:m.a.isEmpty(e.props.community.topicList)?[]:e.props.community.topicList,loading:e.state.tableLoading,pagination:s,onChange:function(t,n,r){var a={pageNum:t.current,limit:t.pageSize};if(!m.a.isEmpty(n))for(var o=0,i=Object.entries(n);o<i.length;o++){var c=W(i[o],2),s=c[0],l=c[1];a[s]=l?l[0]:void 0}a=m.a.isEmpty(r)?Object.assign({},a,{topicTypeId:e.state.categoryValue,limit:a.limit,pageNum:a.pageNum}):Object.assign({},a,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({topicTypeId:e.state.categoryValue,limit:a.limit,pageNum:a.pageNum},r.field,"".concat("descend"===r.order?1:0))),e.setState({filter:Object.assign({},a),currentPage:t.current},function(){e.getDataList(e.state.filter)})}}}},Y=n(585),J=n.n(Y),G=n(1382),Q=n.n(G),X=n(1373),Z=n.n(X),ee=n(1381),te=n.n(ee),ne=(n(1380),n(1496),a.createElement("div",null,a.createElement(T.a,{type:"plus"}),a.createElement("div",{className:"ant-upload-text"},"上传图片")));function re(e){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var le=Z.a.Item,ue=f.a.TextArea,pe=function(e,t,n){return{labelCol:{span:e,offset:n},wrapperCol:{span:t}}},me=function(e){function t(e){var n,o,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),o=this,i=ie(t).call(this,e),(n=!i||"object"!==re(i)&&"function"!=typeof i?ce(o):i).state={isSameTopicName:!1,canCreateTopic:!1,bgFlag:!1,previewImage:"",topicTipText:"",previewVisible:!1,topicName:void 0},n.renderUploadComponent=function(e){var t=n.props.form.getFieldDecorator,r=n.props.community,o=r.currentShowTopic,i=r.setCurrentTopic;return a.createElement(Z.a.Item,{className:"form-upload",label:a.createElement("label",null,a.createElement("span",null,e.label)),labelCol:{span:e.labelCol||4},wrapperCol:{span:e.wrapperCol||18},required:e.required||!1},t(e.field,{initialValue:o&&o[e.field]})(a.createElement(te.a,{key:e.field,className:"logo-square ".concat(e.className),accept:e.format||"image/*",action:"",listType:"picture-card",onPreview:function(t){return n.handlePreview(t,e.bgFlag)},beforeUpload:function(t){if(e.format){var r=e.format.split(",").includes(t.type);return r||n.$msg.error("请上传正确格式图片"),r}return!0},onRemove:function(t){i(ae({},e.field,void 0),!1),n.setState({bgFlag:!1})},customRequest:function(t){return n.customRequest(e,t)},fileList:o&&o[e.field]},ne)),a.createElement("span",{className:"form-upload-tip"},e.tip))},n.checkTopicName=function(e){return r.a(ce(n),void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,a,o,i,c,s,l,u,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.props.topicTypeId,r=this.props.community.currentTopic,a={topicName:e,topicTypeId:r.topicTypeId||n},this.props.community.setCurrentTopic({topicName:e},!1),t.next=6,this.$api.community.checkTopicName({params:a});case 6:o=t.sent,i=o.data.data,c=i.list,s=i.status,l="",u=!1,0==s?(l="暂无话题“".concat(e,"”，将会创建该话题并归并到分类下"),u=!0):1==s?(l="当前分类下已存在该话题”".concat(e,"“"),u=!1):2==s?(l="其他分类已存在该话题”".concat(e,"“"),u=!1):9==s&&(l="当前话题分类暂无话题“".concat(e,"”，将会将该话归并到该分类下"),u=!0,delete(p=c[0]).topicId,this.props.community.setCurrentTopic(p)),this.setState({canCreateTopic:u,topicTipText:l});case 14:case"end":return t.stop()}},t,this)}))},n.handlePreview=function(e,t){n.setState({previewImage:e.url||e.thumbUrl,previewVisible:!0,bgFlag:t})},n.customRequest=function(e,t){var r=n.props.community.setCurrentTopic;if(e.limit&&t.file.size/1024>e.limit)return n.$msg.error("图片大小不得超过 ".concat(e.limit,"kb")),Promise.reject(0);function a(){var n=this;m.a.uploadFile({file:t.file,fileName:t.file.name,ypModel:"community_topic"}).then(function(t){r(ae({},e.field,t),!1),n.forceUpdate()})}e.size?m.a.getFileInfo(t.file,function(t){t.width!==e.size.width||t.height!==e.size.height?n.$msg.warning("请上传正确尺寸图片"):a()}):a()},n.onTopicNameChange=function(e){var t=e.target.value?e.target.value.trim():"";n.setState({topicName:t}),t&&n.setState({sameTopicText:void 0}),n.checkTopicName(e.target.value)},n.handleCancel=function(){n.setState({previewVisible:!1})},n.renderModal=function(){var e=n.state,t=e.previewImage,r=e.previewVisible,o=e.bgFlag,i=o?{backgroundColor:"#666",minWidth:80,maxWidth:320,margin:"0 auto"}:{};return a.createElement(c.a,{visible:r,className:"".concat(o?"blank-transparent-bg":""),bodyStyle:i,footer:null,onCancel:n.handleCancel},a.createElement("img",{alt:"example",style:{width:"100%",objectFit:"contain"},src:t}))},n.checkTopicName=$()(n.checkTopicName,500),n}var n,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(t,o["a"]),n=t,(i=[{key:"componentDidMount",value:function(){return r.a(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.props.onRef(this);case 1:case"end":return e.stop()}},e,this)}))}},{key:"render",value:function(){var e=this.props.community,t=e.setCurrentTopic,n=e.currentTopic,r=e.currentShowTopic,o=this.props.form.getFieldDecorator,i=this.state.topicTipText;return a.createElement("div",{className:"editor topic-editor"},a.createElement(Z.a,{className:"editor-form"},a.createElement(le,Object.assign({label:"话题名称"},pe(4,16),{required:!0}),o("topicName",{initialValue:r&&r.topicName})(a.createElement(f.a,{placeholder:"请输入话题名称",onChange:this.onTopicNameChange,disabled:n.topicTypeId})),a.createElement("span",{style:{color:"#999999",fontSize:12,display:"inline-block",lineHeight:2,wordBreak:"break-all"}},i)),a.createElement(a.Fragment,null,this.renderUploadComponent({label:"配图",field:"topicBanner",format:"image/png,image/jpg,image/jpeg",size:{width:750,height:340},tip:"*支持扩展名：png,jpg；图片尺寸： 750*340px"}),a.createElement(le,Object.assign({label:"话题简介"},pe(4,16)),o("topicDesc",{initialValue:r&&r.topicDesc,rules:[]})(a.createElement(ue,{rows:6,onChange:function(e){t({topicDesc:e.target.value},!1)}}))))),this.renderModal())}}])&&oe(n.prototype,i),s&&oe(n,s),t}(),de=me=r.b([Z.a.create(),Object(l.b)("common","community")],me);function fe(e){return(fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ye(e){return(ye=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function be(e,t){return(be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var we=c.a.confirm,Ce=function(e){function t(){var e,n,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=this,o=ye(t).apply(this,arguments),(e=!o||"object"!==fe(o)&&"function"!=typeof o?ve(n):o).$topicEditor=null,e.state={tableLoading:!1,topicModalVisible:!1,selectedRowKeys:[],categoryOptions:[],categoryValue:void 0,categoryOptionsMeta:{total:0,pageNum:1,limit:20},currentPage:1,filter:{},currentCategory:null,topicField:"topicName",topicValue:void 0,order:{key:void 0,value:void 0}},e.resetPagination=function(t,n){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({filter:Object.assign({},this.state.filter,{limit:t,pageNum:n})},function(){return r.a(a,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.filter,this.getDataList(t);case 2:case"end":return e.stop()}},e,this)}))});case 1:case"end":return e.stop()}},e,this)}))},e.toggleTopicModal=function(){e.setState({topicModalVisible:!e.state.topicModalVisible})},e.getDataList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},e.state.filter,t);e.setState({filter:n,tableLoading:!0},function(){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$store.community.getTopicList({params:n});case 2:this.setState({tableLoading:!1});case 3:case"end":return e.stop()}},e,this)}))})},e.renderOrderElem=function(t){var n=e.state.order;return a.createElement("div",{key:t.topicId},a.createElement("span",null,"排序  "),a.createElement(g.a,{min:0,onChange:e.changeOrder.bind(ve(e),t.topicId),value:n.value}))},e.setTopicField=function(t){var n=e.state.filter;"topicId"!==t?delete n.topicId:"topicName"!==t&&delete n.topicName,e.setState({topicField:t,topicValue:void 0,filter:Object.assign({},n,he({},t,void 0))})},e.setTopicValue=function(t){e.setState({topicValue:t,filter:Object.assign({},e.state.filter,he({},e.state.topicField,t||void 0))})},e.onFilterSelect=function(t,n,r){var a;e.setState((he(a={},t,n),he(a,"filter",Object.assign({},e.state.filter,he({},t,n||void 0))),a),function(){e.onSearch()})},e.changeOrder=function(t,n){return n&&Number.isNaN(Number(n))?e.$msg.error("请输入正确排序值"):n&&n.toString().length>3?e.$msg.error("排序值不得超过 3 位"):void e.setState({order:{key:t,value:n}})},e.confirmOrder=function(t){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.order,n=this.props.common.userInfo,e.next=4,this.$api.community.updateWeight({params:{topicId:t.key,weight:t.value,updateUser:n.empId}});case 4:0==(r=e.sent).data.ret?(this.$msg.success("修改排序成功"),this.getDataList(this.state.filter),this.cancelOrder()):this.$msg.error(r.data.msg);case 6:case"end":return e.stop()}},e,this)}))},e.cancelOrder=function(){e.setState({showPopconfirmId:0,order:{key:void 0,value:void 0}})},e.setCategoryName=function(t){var n=t.target.value;e.setState({currentCategory:Object.assign({},e.state.currentCategory,{name:n?n.trim():void 0})})},e.blockOperation=function(t,n){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var r,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.props.common.userInfo,e.next=3,this.$api.community.blockTopic({params:{topicIds:t.join(","),topicStatus:n,updateUser:r.empId}});case 3:0!=(a=e.sent).data.ret?this.$msg.error(a.data.msg):this.getDataList(this.state.filter);case 5:case"end":return e.stop()}},e,this)}))},e.delOperation=function(t){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var n,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.props.common.userInfo,this.setState({showPopconfirmId:0}),we({title:"话题删除操作",content:"请问是否删除当前选中的话题",onOk:function(){return r.a(a,void 0,void 0,regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$api.community.deleteTopic({params:{topicIds:t.join(","),updateUser:n.empId}});case 2:0==(r=e.sent).data.ret?this.getDataList(this.state.filter):this.$msg.error(r.data.msg);case 4:case"end":return e.stop()}},e,this)}))},onCancel:function(){}});case 3:case"end":return e.stop()}},e,this)}))},e.onTopicModalConfirm=function(){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.community.currentTopic,n=this.props.common.userInfo,this.$topicEditor.state.canCreateTopic||t.topicId){e.next=4;break}return e.abrupt("return",this.$msg.warn("".concat(t.topicName," 话题名称已存在")));case 4:if(!(t.topicName&&t.topicName.length>50)){e.next=6;break}return e.abrupt("return",this.$msg.warn("话题名称字数不得超过 50 字"));case 6:if(!(t.topicDesc&&t.topicDesc.length>500)){e.next=8;break}return e.abrupt("return",this.$msg.warn("话题简介字数不得超过 500 字"));case 8:if(!t.topicId){e.next=15;break}return a={topicBanner:t.topicBanner,topicDesc:t.topicDesc,topicId:t.topicId,updateUser:n.empId},e.next=12,this.$api.community.updateTopic({params:a});case 12:r=e.sent,e.next=19;break;case 15:return o={topicTypeId:this.state.categoryValue,topicName:t.topicName,topicBanner:t.topicBanner,topicDesc:t.topicDesc,createUser:n.empId},e.next=18,this.$api.community.createTopic({params:o});case 18:r=e.sent;case 19:0==r.data.ret?(this.$msg.success(t.topicId?"更新话题成功":"创建话题成功"),this.toggleTopicModal(),this.getDataList(this.state.filter)):this.$msg.error(r.data.msg);case 20:case"end":return e.stop()}},e,this)}))},e.onTopicModalCancel=function(){e.setState({topicModalVisible:!1}),e.props.community.setCurrentTopic({})},e.onCategorySearch=$()(function(t){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$api.community.getCategoryList({pageNum:1,limit:10,topicTypeName:t});case 2:n=e.sent,this.setState({categoryOptions:n.data.data.topicTypeList});case 4:case"end":return e.stop()}},e,this)}))},500),e.onCategorySelect=function(t,n){e.setState({categoryValue:t,filter:Object.assign({},e.state.filter,{topicTypeId:t||void 0})},function(){e.onSearch()})},e.onCategoryFocus=function(){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$api.community.getCategoryList({params:{pageNum:1,limit:10}});case 2:t=e.sent,this.setState({categoryOptions:t.data.data.topicTypeList,categoryOptionsMeta:{total:t.data.data.total,pageNum:t.data.data.pageNum,limit:t.data.data.limit}});case 4:case"end":return e.stop()}},e,this)}))},e.onCategoryPopupScroll=J()(function(t){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var n,r,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.state,r=n.categoryOptions,a=n.categoryOptionsMeta,!(!(!t||!t.target)&&t.target.scrollHeight-(t.target.scrollTop+t.target.clientHeight)<=10&&a.total>r.length)){e.next=7;break}return e.next=5,this.$api.community.getCategoryList({params:{pageNum:a.pageNum+1,limit:10}});case 5:o=e.sent,this.setState({categoryOptions:Q()(this.state.categoryOptions,o.data.data.topicTypeList,"topicTypeId"),categoryOptionsMeta:{total:o.data.data.total,pageNum:o.data.data.pageNum,limit:o.data.data.limit}});case 7:case"end":return e.stop()}},e,this)}))},300),e.onSearch=function(){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this.state.filter).topicId||!Number.isNaN(Number(t.topicId))){e.next=3;break}return e.abrupt("return",this.$msg.error("请输入正确话题 ID"));case 3:this.setState({filter:Object.assign({},t,{pageNum:1}),currentPage:1},function(){n.getDataList(n.state.filter)});case 4:case"end":return e.stop()}},e,this)}))},e.onReset=function(){return r.a(ve(e),void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={pageNum:1,limit:this.state.filter.limit,topicTypeId:this.state.categoryOptions[0].topicTypeId},n=this.props.location.pathname,this.props.history.replace(n),this.setState({categoryValue:this.state.categoryOptions[0].topicTypeId,topicValue:void 0,topicStatus:void 0,filter:t,currentPage:1},function(){r.getDataList(r.state.filter)});case 4:case"end":return e.stop()}},e,this)}))},e.onBatch=function(t){var n=e.state.selectedRowKeys;if(t&&m.a.isEmpty(n))return e.$msg.warning("请选择至少一条记录");"block"===t?e.blockOperation(n,9):"unblock"===t?e.blockOperation(n,1):"remove"===t&&e.delOperation(n)},e}var n,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&be(e,t)}(t,o["a"]),n=t,(i=[{key:"componentDidMount",value:function(){return r.a(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r,a,o,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.common.paginationConfig,n=t.defaultPageSize,r=t.defaultCurrent,a=this.props.location,o=this.$qs.parse(a.search),i=0,!o.categoryId){e.next=10;break}return e.next=7,this.$api.community.getCategoryList({params:{pageNum:1,limit:10,topicTypeId:Number(o.categoryId)}});case 7:c=e.sent,e.next=13;break;case 10:return e.next=12,this.$api.community.getCategoryList({params:{pageNum:1,limit:10}});case 12:c=e.sent;case 13:i=m.a.isEmpty(c.data.data.topicTypeList)?void 0:c.data.data.topicTypeList[0].topicTypeId,this.setState({categoryOptions:c.data.data.topicTypeList,categoryOptionsMeta:c.data.data.meta,categoryValue:i,filter:Object.assign({},this.state.filter,{topicTypeId:i})}),this.resetPagination(n,r);case 16:case"end":return e.stop()}},e,this)}))}},{key:"render",value:function(){var e=this,t=this.state.topicModalVisible,n=this.props.community.currentTopic;return a.createElement("div",{className:"category-list"},a.createElement(R.a,Object.assign({},this.props,{config:q(this)})),t&&a.createElement(c.a,{visible:t,title:m.a.isEmpty(n.topicId)?"添加话题":"编辑话题",onOk:this.onTopicModalConfirm,onCancel:this.onTopicModalCancel},a.createElement(de,{onRef:function(t){return e.$topicEditor=t},topicTypeId:this.state.categoryValue})))}}])&&ge(n.prototype,i),s&&ge(n,s),t}(),Ee=Ce=r.b([Object(l.b)("common","community"),l.c],Ce);function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ke(e,t){return!t||"object"!==Se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ne(e){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}c.a.confirm;var Ie=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ke(this,Ne(t).apply(this,arguments))).state={currentTab:"category-list",filter:{}},e.onTabClick=function(t){e.setState({currentTab:t},function(){var n="/admin/community/topic/category/".concat(t);e.props.history.push(n)})},e.toggleTab=function(t){e.setState({currentTab:t})},e}var n,i,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(t,o["a"]),n=t,c=[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.location.pathname.split("/"),r=n[n.length-1];return"category"===r?{currentTab:"category-list"}:"category-list"===r||"topic-list"===r?{currentTab:r}:null}}],(i=[{key:"componentDidMount",value:function(){return r.a(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"/admin/community/topic/category"===(t=this.props.location.pathname)?this.props.history.replace("/admin/community/topic/category/category-list"):"/admin/community/topic/category/category-list"===t?this.setState({currentTab:"category-list"}):this.setState({currentTab:"topic-list"});case 2:case"end":return e.stop()}},e,this)}))}},{key:"componentDidUpdate",value:function(e,t){"/admin/community/topic/category"===this.props.location.pathname&&("category-list"!==t.currentTab&&this.setState({currentTab:"category-list"}),this.props.history.replace("/admin/community/topic/category/category-list"))}},{key:"render",value:function(){var e=this,t=this.state.currentTab;return a.createElement("div",{className:"topic-category"},a.createElement(u.a,Object.assign({},this.props,{currentTab:t,onTabClick:this.onTabClick,title:"话题分类管理",tabs:[{id:"category-list",title:"话题分类",path:"/admin/community/topic/category-list"},{id:"topic-list",title:"分类下的话题",path:"/admin/community/topic/topic-list"}]})),a.createElement(s.a,{path:"/admin/community/topic/category/category-list",render:function(t){return a.createElement(U,Object.assign({},t,{toggleTab:e.toggleTab}))}}),a.createElement(s.a,{path:"/admin/community/topic/category/topic-list",render:function(e){return a.createElement(Ee,Object.assign({},e))}}))}}])&&Te(n.prototype,i),c&&Te(n,c),t}();Ie=r.b([Object(p.a)("/admin/community/topic/category",{exact:!1}),Object(l.b)("common","community"),l.c],Ie);t.default=Ie}}]);