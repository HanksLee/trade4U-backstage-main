(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1063:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(1),a=n(1043),o=n.n(a),i=(n(1042),n(34));n(1064);function c(e){var t=i.a.getPageBreadcrumb(e.location.pathname),n=e.title,a=e.links,c=e.tabs,s=e.currentTab;return r.createElement("div",{className:"common-header"},r.createElement("section",{className:"common-header-breadcrumb"},t&&r.createElement(o.a,null,t.map((function(e,t){return r.createElement(o.a.Item,{key:t},e.title)})))),r.createElement("section",{className:"common-header-title"},r.createElement("h2",null,n),r.createElement("div",{className:"common-header-links"},a&&a.map((function(t,n){return r.createElement("a",{key:n,onClick:function(){e.history.push(t.path)}},t.title)})))),r.createElement("section",{className:"common-header-tabs"},c&&c.map((function(t,n){return r.createElement("a",{onClick:function(){e.onTabClick(t.id)},className:"".concat(s===t.id?"tab-active":""," ")},r.createElement("span",null,t.title),t.tipComponent&&t.tipComponent())}))))}},1064:function(e,t,n){},1065:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),a=n(93);function o(e,t){return function(n){return function(){return r.createElement(a.b,Object.assign({path:e},Object.assign({exact:!0},t),{render:function(e){return r.createElement(n,Object.assign({},e))}}))}}}},1066:function(e,t,n){"use strict";n.d(t,"a",(function(){return D}));var r=n(1),a=(n(1067),n(96)),o=n.n(a),i=(n(133),n(289)),c=n.n(i),s=(n(432),n(134)),l=n.n(s),u=(n(204),n(1041)),m=n.n(u),p=(n(1040),n(1049)),d=n.n(p),f=(n(1048),n(205)),h=n.n(f),b=(n(434),n(17)),g=n.n(b),y=(n(203),n(437)),v=n.n(y),E=(n(436),n(438)),k=n.n(E),w=(n(435),n(440)),O=n.n(w),C=(n(439),n(34)),S=n(22),j=n.n(S);function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var L=c.a.Option,R=l.a.Group,I=d.a.RangePicker,T=O.a.CheckableTag,$={SelectInput:function(e){var t=e.selectValue,n=e.inputValue,a=e.placeholder,o=e.options,i=e.onSelectChange,s=e.onInputChange,u=e.onPressEnter,m=e.selectStyle;return r.createElement(R,{compact:!0},r.createElement(c.a,{style:m?Object.assign({width:110},m):{width:110},value:t,onChange:i},o&&o.map((function(e,t){return r.createElement(L,{key:t,value:e.value},e.title)}))),r.createElement(l.a,{style:{width:238},value:n,onChange:s,placeholder:a,onPressEnter:u}))},Select:function(e){var t=e.option,n=e.label,a=e.mode,o=e.onSearch,i=e.onSelect,s=e.onBlur,l=e.onFocus,u=e.value,m=e.placeholder,p=e.showSearch,d=e.width,f=e.filterOption,h=e.onChange,b=e.allowClear,g=e.onPopupScroll;return r.createElement(r.Fragment,null,n&&r.createElement("span",{className:"common-list-label"},"".concat(n,"：")),r.createElement("span",{className:"common-list-control"},r.createElement(c.a,{allowClear:b,value:u,mode:a||!1,style:{minWidth:d||258,width:d},showSearch:p,placeholder:m,filterOption:f,onSearch:o,onSelect:i,onChange:h,onBlur:s,onPopupScroll:g,onFocus:l},t.data.map((function(e){return r.createElement(L,{key:e[t.key]||e.id,value:e[t.value]||e.id,$data:e},e[t.title])})))))},DatePicker:function(e){var t=e.label,n=e.placeholder,a=e.onChange,o=e.value,i=e.style,c=e.format,s=e.showTime;return r.createElement(r.Fragment,null,t&&r.createElement("span",{className:"common-list-label"},"".concat(t,"：")),r.createElement("span",{className:"common-list-control"},r.createElement(d.a,{format:c||!1,style:i,showTime:s,placeholder:n,value:o,onChange:a})))},RangePicker:function(e){var t=e.label,n=e.alias,a=e.placeholder,i=e.onChange,c=e.value,s=e.showTime,l=e.format;return r.createElement(r.Fragment,null,t&&r.createElement("span",{className:"common-list-label"},"".concat(t,"：")),r.createElement("span",{className:"common-list-control"},r.createElement(I,{style:{width:400},showTime:s,format:l,placeholder:a,value:c,onChange:i}),r.createElement("span",{className:"common-list-control-date-alias"},!C.a.isEmpty(n)&&n.map((function(e,t){return r.createElement(o.a,{key:t,onClick:function(){return i([j()(Date.now()-864e5*e).startOf("day"),j()()])}},e," 天内")})))))},Input:function(e){var t=e.label,n=e.value,a=e.placeholder,o=e.onChange,i=e.width,c=e.onPressEnter;return r.createElement(r.Fragment,null,t&&r.createElement("span",{className:"common-list-label"},"".concat(t,"：")),r.createElement("span",{className:"common-list-control"},r.createElement(l.a,{style:{minWidth:i||258},value:n,onChange:o,placeholder:a,onPressEnter:c})))},Checkbox:function(e){var t=e.label,n=e.value,a=e.onChange;return r.createElement(h.a,{checked:n,onChange:a},t)},CheckableTag:function(e){var t=e.label,n=e.option,a=e.value,o=e.onChange;return r.createElement(r.Fragment,null,t&&r.createElement("span",{className:"common-list-label"},"".concat(t,"：")),r.createElement("span",{className:"common-list-control"},!C.a.isEmpty(n)&&n.map((function(e){return r.createElement(T,{key:e.value,checked:e.value===a,onChange:function(){o(e)}},e.title)}))))},Label:function(e,t){var n=e.label;return r.createElement(r.Fragment,null,n&&r.createElement("span",{className:"common-list-label"},"".concat(n,"：")),r.createElement("span",{className:"common-list-control"},t))},Custom:function(e){return r.createElement("div",null,(void 0).props.children)}},D=function(e){function t(){var e;return P(this,t),(e=x(this,B(t).apply(this,arguments))).state={collapse:!0},e.toggleCollapse=function(t){e.setState({collapse:!e.state.collapse})},e.renderSearcher=function(){var t=e.props.config,n=t.searcher,a=t.table,i=e.state.collapse,c=a&&a.tableHeader;return n&&r.createElement("section",{className:"common-list-search"},e.renderWidgets(n.widgets),c&&r.createElement(c,null),r.createElement("div",{className:"common-list-search-right"},!n.hideSearcher&&r.createElement(r.Fragment,null,r.createElement(o.a,{type:"primary",onClick:n.onSearch},"查询"),r.createElement(o.a,{onClick:n.onReset},"重置")),n.collapseControl&&n.collapseControl.showMoreBtn&&r.createElement("span",{className:"common-list-serach-more"},r.createElement("a",{onClick:e.toggleCollapse},i?"更多":"收起"," ",r.createElement(g.a,{type:i?"down":"up"})))))},e.renderWidgets=function(t){var n=e.state.collapse,a=e.props.config.searcher;return t&&r.createElement("div",{className:"common-list-search-left"},t.map((function(t,o){return Array.isArray(t)?r.createElement("div",{key:o,className:"common-list-search-row",style:{display:a.collapseControl&&a.collapseControl.showMoreBtn&&n&&o>0?"none":"flex"}},t.map((function(t){return r.createElement("div",{key:t.label,className:"common-list-search-col",style:Object.assign({},t.style)},$[t.type]&&$[t.type](t,t.children?e.renderWidgets(t.children):null))}))):r.createElement("div",{key:t.label,className:"common-list-search-row ".concat(t.className)},$[t.type]&&$[t.type](t,t.children?e.renderWidgets(t.children):null))})))},e.renderAddBtn=function(){var t=e.props.config,n=t.addBtn,a=t.searcher,o=n&&n.title;return n&&r.createElement("section",{className:"common-list-addbtn",style:n.style},"function"==typeof n.title?r.createElement(o,null):n.title,r.createElement("div",{className:"common-list-search-batch"},a.batchControl.showBatchControl&&r.createElement(c.a,{placeholder:a.batchControl.placeholder,style:{minWidth:120},defaultValue:void 0,onChange:a.batchControl.onBatch},a.batchControl.options.map((function(e){return r.createElement(L,{key:e.value,value:e.value},e.title)})))))},e.renderTableHeader=function(){var t=e.props.config.tableHeader,n=t;return r.createElement("section",{className:"common-list-table-header"},t&&r.createElement(n,null))},e.renderTable=function(){var t=e.props.config.table,n=t.rowKey,a=t.rowSelection,o=t.columns,i=t.dataSource,c=t.pagination,s=t.onChange,l=t.loading,u=t.locale;return r.createElement("section",{className:"common-list-table"},r.createElement(m.a,{locale:u,rowKey:n||"id",rowSelection:a,columns:o,dataSource:i,loading:l,pagination:c,onChange:s}))},e.renderCards=function(){var t=e.props.config.cards,n=t.dataSource,a=t.loading,o=t.pagination,i=t.renderCard,c=t.addBtn;return r.createElement("div",{className:"common-list-cards-wrapper"},r.createElement("ul",{className:"common-list-cards"},a?r.createElement("div",{className:"common-list-cards-loading"},r.createElement(k.a,null)):r.createElement(r.Fragment,null,r.createElement("li",{className:"common-list-card add-btn"},r.createElement("div",{className:"common-list-card-item",onClick:c.onAddBtnClick},c.icon?r.createElement("img",{src:c.icon,alt:""}):r.createElement(g.a,{type:"plus-circle"}),r.createElement("p",null,c.title))),n.map((function(e){return r.createElement("li",{className:"common-list-card"},r.createElement("div",{className:"common-list-card-item"},i(e)))})))),r.createElement("section",{className:"common-list-cards-pagination"},r.createElement(v.a,Object.assign({},o))))},e}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(t,e),n=t,(a=[{key:"render",value:function(){var e=this.props.config;return r.createElement("div",{className:"common-list"},this.renderSearcher(),this.renderAddBtn(),this.renderTableHeader(),e.table&&this.renderTable(),e.cards&&this.renderCards())}}])&&_(n.prototype,a),i&&_(n,i),t}(r.Component)},1067:function(e,t,n){},1068:function(e,t,n){"use strict";var r=function(e){var t=e;return 15===e.length&&(t=function(e){if(/^\d{15}$/.test(e)){e=e.substr(0,6)+"19"+e.substr(6,e.length-6);for(var t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],n=0,r=0;r<e.length;r++)n+=parseInt(e.substr(r,1))*t[r];return e+["1","0","X","9","8","7","6","5","4","3","2"][n%11]}return e}(e)),function(e){if(!/^\d{17}(\d|x)$/i.test(e))return!1;return null!=={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙",21:"辽宁",22:"吉林",23:"黑龙",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",83:"台湾",91:"国外"}[parseInt(e.substr(0,2))]}(t)},a=function(e){return/^[HMhm]{1}([0-9]{8})$/.test(e)},o=function(e){return/^[0-9]{8}$/.test(e)||/^[0-9]{10}$/.test(e)},i=function(e){return/^[a-zA-Z]{5, 17}$/.test(e)||/^[a-zA-Z0-9]$/.test(e)},c=n(34);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"a",(function(){return u}));var l={isNonEmpty:function(e,t,n){if(0!==e&&c.a.isEmpty(e))return n&&n(),t},maxLength:function(e,t,n,r){if(e.length>t)return r&&r(),n},minLength:function(e,t,n,r){if(e.length<t)return r&&r(),n},isEmail:function(e,t,n){if(!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e))return n&&n(),t},isMobile:function(e,t,n){if(!/^(13[0-9]|14[57]|15[012356789]|16[0-9]|18[0-9]|17[0-9]|19[0-9])\d{8}$/.test(e))return n&&n(),t},isID:function(e,t,n,c){var s=null;if("id"===t?s=r:"HKMC"===t?s=a:"TW"===t?s=o:"PSPort"===t&&(s=i),!s(e))return c&&c(),n},isNumber:function(e,t,n){if(e&&Number.isNaN(Number(e)))return n&&n(),t},isHexColor:function(e,t,n){var r=e.toString();if(!r||!function(e){if("#"!==e[0])return!1;var t=e.slice(1);return 6===t.length&&/^[0-9a-fA-f]{6}$/.test(t)}(r))return n&&n(),t},isUrl:function(e,t,n){var r=e.toString();if(!r||!/^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i.test(r))return n&&n(),t},customReg:function(e,t,n,r){var a=e.toString();if(!a||!new RegExp(t).test(a))return r&&r(),n}},u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cache=[]}var t,n,r;return t=e,(n=[{key:"add",value:function(e,t){var n=this,r=!0,a=!1,o=void 0;try{for(var i,c=function(){var t=i.value,r=t.strategy.split(":");n.cache.push((function(){var n=r.shift();return r.unshift(e),r.push(t.errMsg),r.push(t.cb),l[n].apply(null,r)}))},s=t[Symbol.iterator]();!(r=(i=s.next()).done);r=!0)c()}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}}},{key:"start",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.cache[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var o=(0,r.value)();if(o)return o}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}}])&&s(t.prototype,n),r&&s(t,r),e}()},1071:function(e,t,n){},1081:function(e,t,n){"use strict";n.r(t);var r=n(9),a=n(1068),o=n(1),i=n(83),c=n(85),s=n.n(c),l=(n(433),n(134)),u=n.n(l),m=(n(204),n(96)),p=n.n(m),d=(n(133),n(1052)),f=n.n(d),h=(n(1051),n(17)),b=n.n(h),g=(n(203),n(84));function y(e){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return!t||"object"!==y(t)&&"function"!=typeof t?C(e):t}function O(e){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var j=s.a.Item,N=function(e,t,n){return{labelCol:{span:e,offset:n},wrapperCol:{span:t}}},P=function(e){function t(){var e;return E(this,t),(e=w(this,O(t).apply(this,arguments))).state={mode:"add",brokerOptions:[],brokerDetail:null},e.renderEditor=function(){var t=e.props.form.getFieldDecorator,n=e.state.brokerDetail;return o.createElement(s.a,{className:"editor-form"},o.createElement(j,Object.assign({label:"券商名称"},N(3,12),{required:!0}),t("name",{initialValue:n&&n.name})(o.createElement(u.a,{placeholder:"请输入券商名称",onChange:function(t){e.setCurrentBroker({name:t.target.value})},style:{display:"inline-block",width:200}}))),o.createElement(j,Object.assign({label:"域名"},N(3,12),{required:!0,extra:"示例：http://www.baidu.com"}),t("domain",{initialValue:n&&n.domain})(o.createElement(u.a,{placeholder:"请输入域名",onChange:function(t){e.setCurrentBroker({domain:t.target.value})},style:{display:"inline-block",width:200}}))),o.createElement(j,Object.assign({label:"后台角标"},N(3,12),{required:!0}),t("background_corner")(o.createElement(f.a,{accept:"image/*",listType:"picture-card",showUploadList:!1,beforeUpload:e.beforeBackgroundCornerUpload},n&&n.background_corner?o.createElement("div",{className:"upload-image-preview",style:{backgroundImage:"url(".concat(n.background_corner,")")}}):o.createElement("div",{className:"upload-image-preview"},o.createElement(b.a,{type:"plus"}))))),o.createElement(j,Object.assign({label:"logo"},N(3,12),{required:!0}),t("logo")(o.createElement(f.a,{accept:"image/*",listType:"picture-card",showUploadList:!1,beforeUpload:e.beforeLogoUpload},n&&n.logo?o.createElement("div",{className:"upload-image-preview",style:{backgroundImage:"url(".concat(n.logo,")")}}):o.createElement("div",{className:"upload-image-preview"},o.createElement(b.a,{type:"plus"}))))),o.createElement(j,{className:"editor-form-btns"},o.createElement(p.a,{type:"primary",onClick:e.handleSubmit},"edit"===e.state.mode?"确认修改":"保存"),o.createElement(p.a,{onClick:e.goBack},"取消")))},e.setCurrentBroker=function(t){e.setState({brokerDetail:Object.assign(Object.assign({},e.state.brokerDetail),t)})},e.beforeBackgroundCornerUpload=function(t){return e.uploadFile(t,"background_corner"),!1},e.beforeLogoUpload=function(t){return e.uploadFile(t,"logo"),!1},e.uploadFile=function(t,n){return Object(r.a)(C(e),void 0,void 0,regeneratorRuntime.mark((function e(){var r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("file",t),e.next=4,this.$api.common.uploadFile(r);case 4:a=e.sent,this.setCurrentBroker(v({},n,a.data.file_path));case 6:case"end":return e.stop()}}),e,this)})))},e.goBack=function(){e.props.history.goBack()},e.handleSubmit=function(t){return Object(r.a)(C(e),void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.props.form.validateFields((function(e,n){return Object(r.a)(t,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,a,o,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=8;break}if(n=this.state.brokerDetail,r=this.state.mode,a={name:n.name,domain:n.domain,background_corner:n.background_corner,logo:n.logo},!(o=this.getValidation(a))){t.next=7;break}return t.abrupt("return",this.$msg.warn(o));case 7:"add"==r?this.$api.broker.createBroker(a).then((function(e){i.$msg.success("券商创建成功"),i.goBack(),i.props.getBrokerList()})):this.$api.broker.updateBroker(n.id,a).then((function(e){i.$msg.success("券商更新成功"),i.goBack(),i.props.getBrokerList()}));case 8:case"end":return t.stop()}}),t,this)})))}));case 1:case"end":return e.stop()}}),e,this)})))},e.getValidation=function(e){var t=new a.a;return t.add(e.name,[{strategy:"isNonEmpty",errMsg:"请输入券商名称"}]),t.add(e.domain,[{strategy:"isNonEmpty",errMsg:"请输入域名"},{strategy:"isUrl",errMsg:"不合法的域名格式"}]),t.add(e.background_corner,[{strategy:"isNonEmpty",errMsg:"请上传后台角标"}]),t.add(e.logo,[{strategy:"isNonEmpty",errMsg:"请上传logo"}]),t.start()},e}var n,i,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,e),n=t,(i=[{key:"componentDidMount",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.location,n=this.$qs.parse(t.search),this.setState({mode:"0"===n.id?"add":"edit"}),"0"===n.id){e.next=8;break}return e.next=6,this.$api.broker.getBrokerDetail(n.id);case 6:r=e.sent,this.setState({brokerDetail:r.data});case 8:case"end":return e.stop()}}),e,this)})))}},{key:"render",value:function(){return o.createElement("div",{className:"editor food-card-editor"},o.createElement("section",{className:"editor-content panel-block"},this.renderEditor()))}}])&&k(n.prototype,i),c&&k(n,c),t}(i.a),_=P=Object(r.b)([s.a.create(),Object(g.b)("common","broker"),g.c],P),x=n(1041),B=n.n(x),M=(n(1040),n(205)),L=n.n(M);n(434),n(1071);function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t){return(F=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var A=function(e){function t(e){var n,a,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,i=$(t).call(this,e),(n=!i||"object"!==R(i)&&"function"!=typeof i?D(a):i).state={isEditing:!1,menuList:[],formatedMenuList:[],selectedPermissions:[]},n.formateMenuList=function(e){var t=[];return e.forEach((function(e){e.children&&e.children.length>0?e.children.forEach((function(n,r){t.push({parentMenuId:e.id,parentMenuName:e.name,childMenuId:n.id,childMenuName:n.name,permission:n.permission,rowSpan:0===r?e.children.length:0})})):t.push({parentMenuId:e.id,parentMenuName:e.name,permission:e.permission,rowSpan:1})})),t},n.getBrokerMenuList=function(){return Object(r.a)(D(n),void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$api.broker.getBrokerMenuList();case 2:t=e.sent,this.setState({menuList:t.data,formatedMenuList:this.formateMenuList(t.data)});case 4:case"end":return e.stop()}}),e,this)})))},n.getBrokePermission=function(){return Object(r.a)(D(n),void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$api.broker.getBrokerDetail(this.brokerId);case 2:t=e.sent,this.setState({selectedPermissions:t.data.permissions});case 4:case"end":return e.stop()}}),e,this)})))},n.goBack=function(){n.props.history.goBack()},n.editPermission=function(){n.setState({isEditing:!0})},n.savePermission=function(){return Object(r.a)(D(n),void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.state.selectedPermissions,this.$api.broker.updateBrokerPermission({broker_id:this.brokerId,permission_ids:t}).then((function(){n.$msg.success("权限更新成功"),n.goBack(),n.props.getBrokerList()}));case 2:case"end":return e.stop()}}),e,this)})))},n.getTableColumns=function(){var e=n.state.isEditing;return[{key:"parentMenuName",title:"父菜单名称",dataIndex:"parentMenuName",align:"center",render:function(t,r){return{children:o.createElement(o.Fragment,null,o.createElement("div",{style:{marginBottom:"5px"}},t),r.permission.length>0&&o.createElement(L.a,{checked:n.isCheck(r.parentMenuId),disabled:!e,onChange:function(e){return n.handleSelectAllChange(e.target.checked,r.parentMenuId)}},"全选")),props:{rowSpan:r.rowSpan}}}},{key:"childMenuName",title:"子菜单名称",dataIndex:"childMenuName",align:"center"},{key:"permission",title:"权限名称",className:"broker-permission-column",render:function(t,r){return o.createElement(o.Fragment,null,r.permission.length>0&&o.createElement("div",{className:"select-all-permission-row"},o.createElement(L.a,{disabled:!e,checked:n.isCheck(r.childMenuId),onChange:function(e){return n.handleSelectAllChange(e.target.checked,r.childMenuId)}},"全选")),o.createElement("div",{className:"select-permission-row"},r.permission.map((function(t){return o.createElement(L.a,{disabled:!e,checked:-1!==n.state.selectedPermissions.indexOf(t.id),onChange:function(e){return n.handlePermissionCheckboxChange(t.id,e.target.checked)}},t.name)}))))}}]},n.handlePermissionCheckboxChange=function(e,t){var r=n.state.selectedPermissions;if(t)n.setState({selectedPermissions:[].concat(I(r),[e])});else{var a=r.indexOf(e);if(-1!==a){var o=I(r);o.splice(a,1),n.setState({selectedPermissions:o})}}},n.handleSelectAllChange=function(e,t){var r=n.state,a=r.formatedMenuList,o=I(r.selectedPermissions);e?a.forEach((function(e){e.parentMenuId!==t&&e.childMenuId!==t||e.permission.forEach((function(e){-1===o.indexOf(e.id)&&o.push(e.id)}))})):a.forEach((function(e){e.parentMenuId!==t&&e.childMenuId!==t||e.permission.forEach((function(e){-1!==o.indexOf(e.id)&&o.splice(o.indexOf(e.id),1)}))})),n.setState({selectedPermissions:o})},n.isCheck=function(e){for(var t=n.state,r=t.formatedMenuList,a=t.selectedPermissions,o=0;o<r.length;o++){var i=r[o];if(i.parentMenuId===e||i.childMenuId===e)for(var c=0;c<i.permission.length;c++)if(-1===a.indexOf(i.permission[c].id))return!1}return!0},n.brokerId=n.$qs.parse(n.props.location.search).id,n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&F(e,t)}(t,e),n=t,(a=[{key:"componentDidMount",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.getBrokerMenuList(),this.getBrokePermission();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"render",value:function(){var e=this,t=this.state,n=t.formatedMenuList,r=t.isEditing;return o.createElement("div",{className:"editor"},o.createElement("section",{className:"editor-content panel-block common-list"},o.createElement("section",{className:"common-list-addbtn"},r?o.createElement(p.a,{onClick:function(){return e.savePermission()}},"保存编辑"):o.createElement(p.a,{type:"primary",onClick:this.editPermission},"编辑权限"),o.createElement(p.a,{onClick:function(){return e.goBack()}},"取消")),o.createElement(B.a,{className:"broker-permission-table",columns:this.getTableColumns(),dataSource:n,pagination:!1,bordered:!0})))}}])&&T(n.prototype,a),i&&T(n,i),t}(i.a),z=A=Object(r.b)([Object(g.b)("common","broker"),g.c],A),U=n(1063),W=n(1066),H=n(34),V=n(1045),Z=n.n(V),q=(n(1044),void 0);function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var J=function(e){var t=[{title:"券商名称",dataIndex:"name"},{title:"域名",dataIndex:"domain",ellipsis:!0,render:function(e){return o.createElement("a",{href:e,target:"_blank"},e)||"--"}},{title:"后台角标",dataIndex:"background_corner",render:function(e){return o.createElement("div",{className:"upload-image-preview",style:{backgroundImage:"url(".concat(e,")")}})}},{title:"logo",dataIndex:"logo",render:function(e){return o.createElement("div",{className:"upload-image-preview",style:{backgroundImage:"url(".concat(e,")")}})}},{title:"操作",render:function(t,n){return o.createElement("div",{className:"common-list-table-operation"},o.createElement("span",{onClick:function(){return e.goToEditor(n)}},"编辑"),o.createElement("span",{className:"common-list-table-operation-spliter"}),o.createElement("span",{onClick:function(){return e.goToPermissionEditor(n)}},"授权"),o.createElement("span",{className:"common-list-table-operation-spliter"}),o.createElement(Z.a,{title:"请问是否确定删除券商",onConfirm:function(){return q.deleteBroker(n.id)},onCancel:function(){}},o.createElement("span",null,"删除")))}}],n=Object.assign(Object.assign({},e.props.common.paginationConfig),{total:e.state.total,current:e.props.broker.filter.page,pageSize:e.props.broker.filter.page_size,onChange:function(e,t){},onShowSizeChange:function(t,n){e.getDataList({page_size:n,page:t})}});return{addBtn:{title:function(){return o.createElement(p.a,{type:"primary",onClick:function(){return e.goToEditor({})}},o.createElement(b.a,{type:"plus"})," 添加")}},searcher:{batchControl:{placeholder:"请选择",showBatchControl:!H.a.isEmpty(e.state.selectedRowKeys),options:[{title:"删除",value:"delete"}],onBatch:function(t){e.onBatch&&e.onBatch(t)}},widgets:[[{type:"Input",label:"券商名称",placeholder:"请输入券商名称",value:e.state.tempFilter.name||void 0,onChange:function(t){e.onInputChanged("name",t.target.value)},onPressEnter:function(t){e.onSearch()}}]],onSearch:function(){e.onSearch()},onReset:function(){e.onReset()}},table:{rowKey:"id",columns:t,dataSource:e.state.brokerList,pagination:n,onChange:function(t,n){var r={};if(!H.a.isEmpty(n))for(var a=0,o=Object.entries(n);a<o.length;a++){var i=K(o[a],2),c=i[0],s=i[1];r[c]=s?s[0]:void 0}e.getDataList({page_size:t.pageSize,page:t.current})}}}},G=n(1065),X=n(93);function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ne(e,t){return!t||"object"!==Q(t)&&"function"!=typeof t?ae(e):t}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ae(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e,t){return(oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ie=function(e){function t(){var e;return ee(this,t),(e=ne(this,re(t).apply(this,arguments))).state={brokerList:[],tableLoading:!1,selectedRowKeys:[],tempFilter:{},total:0},e.getDataList=function(t){return Object(r.a)(ae(e),void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,a,o,i,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t?Object.assign(Object.assign({},this.props.broker.filter),t):this.props.broker.filter,this.setState({tableLoading:!0}),e.next=4,this.$api.broker.getBrokerList({params:n});case 4:r=e.sent,a=r.data,o=a.results,i=a.page_size,c=a.current_page,s=a.count,0===r.data.results.length&&0!==r.data.offset?this.getDataList(Object.assign(Object.assign({},n),{page:c-1})):(this.props.broker.setFilter({page_size:i,page:c,name:n.name}),this.setState({brokerList:o,tableLoading:!1,total:s}));case 7:case"end":return e.stop()}}),e,this)})))},e.onSearch=function(){return Object(r.a)(ae(e),void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.getDataList(Object.assign({page:1},this.state.tempFilter));case 1:case"end":return e.stop()}}),e,this)})))},e.onReset=function(){return Object(r.a)(ae(e),void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.getDataList({name:void 0,page:1}),this.setState({tempFilter:{}});case 2:case"end":return e.stop()}}),e,this)})))},e.onInputChanged=function(t,n){e.setState((function(e){return{tempFilter:Object.assign(Object.assign({},e.tempFilter),Y({},t,n))}}))},e.goToEditor=function(t){var n="/dashboard/broker/editor?id=".concat(H.a.isEmpty(t)?0:t.id);e.props.history.push(n)},e.goToPermissionEditor=function(t){var n="/dashboard/broker/permission?id=".concat(H.a.isEmpty(t)?0:t.id);e.props.history.push(n)},e.deleteBroker=function(t){return Object(r.a)(ae(e),void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$api.broker.deleteBroker(t);case 2:204===(n=e.sent).status?this.getDataList():this.$msg.error(n.data.message);case 4:case"end":return e.stop()}}),e,this)})))},e}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oe(e,t)}(t,e),n=t,(a=[{key:"componentDidMount",value:function(){return Object(r.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props.broker.filter,n=this.props.common.paginationConfig,this.getDataList({page_size:t.page_size||n.defaultPageSize,page:t.page||1});case 3:case"end":return e.stop()}}),e,this)})))}},{key:"componentDidUpdate",value:function(){"/dashboard/broker"===this.props.location.pathname&&this.props.history.replace("/dashboard/broker/list")}},{key:"render",value:function(){var e=this,t=this.props.match;return o.createElement("div",null,o.createElement(U.a,Object.assign({},this.props,{links:[],title:"券商管理"})),o.createElement(X.b,{path:"".concat(t.url,"/list"),render:function(t){return o.createElement(W.a,Object.assign({},t,{config:J(e)}))}}),o.createElement(X.b,{path:"".concat(t.url,"/editor"),render:function(t){return o.createElement(_,Object.assign({},t,{getBrokerList:e.getDataList}))}}),o.createElement(X.b,{path:"".concat(t.url,"/permission"),render:function(t){return o.createElement(z,Object.assign({},t,{getBrokerList:e.getDataList}))}}))}}])&&te(n.prototype,a),i&&te(n,i),t}(i.a);ie=Object(r.b)([Object(G.a)("/dashboard/broker",{exact:!1}),Object(g.b)("common","broker"),g.c],ie);t.default=ie}}]);